# Railway Deployment Manual Instructions

## Prerequisites
- Railway account (create at https://railway.app)
- GitHub repository connected (https://github.com/pranab112/consultency.git)
- Railway CLI installed (optional)

## Step-by-Step Manual Deployment

### 1. Login to Railway Dashboard
1. Go to https://railway.app
2. Sign in with your GitHub account

### 2. Create New Project
1. Click "New Project"
2. Select "Deploy from GitHub repo"
3. Choose repository: `pranab112/consultency`
4. Select branch: `main`

### 3. Configure Environment Variables
In the Railway dashboard, go to Variables tab and add:

```
NODE_ENV=production
JWT_SECRET=your-super-secret-jwt-key-change-this
JWT_EXPIRES_IN=7d
DATABASE_URL=(Railway will auto-generate this when you add PostgreSQL)
DB_TYPE=postgres
CORS_ORIGIN=*
MAX_FILE_SIZE=10485760
UPLOAD_DIR=./uploads
PORT=(Railway will auto-generate this)

# Frontend variables (if deploying frontend together)
VITE_API_URL=https://your-app.up.railway.app/api
VITE_GOOGLE_AI_API_KEY=your-google-ai-api-key-here
```

**Important Notes:**
- `DATABASE_URL` will be auto-generated when you add PostgreSQL
- `PORT` will be auto-generated by Railway
- Update `VITE_API_URL` with your actual Railway app URL after deployment
- Change `JWT_SECRET` to a secure random string for production
- `CORS_ORIGIN` is set to `*` for development, consider restricting in production

### 4. Add PostgreSQL Database
1. In your Railway project, click "New"
2. Select "Database"
3. Choose "PostgreSQL"
4. Railway will automatically:
   - Create the database
   - Add DATABASE_URL to your environment

### 5. Configure Build Settings
The following files are already configured in your repository:

- `railway.json` - Build and deployment configuration
- `nixpacks.toml` - Build environment setup
- `server/package.json` - Contains build and start scripts

### 6. Trigger Deployment
Railway will automatically deploy when:
- You push changes to GitHub
- You manually trigger from Railway dashboard (click "Deploy")

### 7. Monitor Deployment
1. Check build logs in Railway dashboard
2. Look for "Build successful" message
3. Once deployed, Railway will provide a URL like: `your-app.up.railway.app`

### 8. Verify Deployment
Test your endpoints:
```bash
# Health check
curl https://your-app.up.railway.app/api/health

# Test authentication
curl -X POST https://your-app.up.railway.app/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"test@example.com","password":"password123"}'
```

## Troubleshooting

### If TypeScript compilation fails:
The TypeScript configuration has been relaxed to ensure compilation:
- Check `/server/tsconfig.json` has `"strict": false`
- Verify latest commit `113816d` is deployed

### If build fails with Nixpacks:
- Ensure `nixpacks.toml` only contains `nodejs_18` (not `npm`)
- Railway uses Nixpacks v1.29.2 by default

### If database connection fails:
- Verify DATABASE_URL is set in Railway environment
- Check PostgreSQL service is running in Railway
- Database auto-syncs on first connection

### Clear Build Cache (if needed):
1. Go to Settings in Railway dashboard
2. Find "Clear build cache" option
3. Click to clear and redeploy

### Manual Redeploy:
1. In Railway dashboard, go to Deployments tab
2. Click "Trigger Deployment"
3. Or use Railway CLI:
   ```bash
   railway up --detach
   ```

## Current Status
✅ TypeScript compilation fixed
✅ Database connection working (using DATABASE_URL)
✅ PostgreSQL database initialized
✅ Health endpoint added (/api/health)
✅ All fixes pushed to GitHub (latest commit ccb4832)

## Verify Deployment Success

### 1. Check Application Health
Once deployed, visit: `https://your-app.up.railway.app/api/health`
Should return:
```json
{
  "status": "ok",
  "timestamp": "...",
  "environment": "production",
  "database": "postgres"
}
```

### 2. Check Database Tables
In Railway Dashboard → PostgreSQL Service → Data tab, you should see:
- `users` table
- `students` table
- `activities` table

### 3. Default Admin Login
- Email: `admin@studyabroad.com`
- Password: `admin123`

## Support
- Railway Documentation: https://docs.railway.app
- Project Repository: https://github.com/pranab112/consultency
- Railway Status: https://status.railway.app